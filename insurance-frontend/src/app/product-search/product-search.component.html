<div class="container">
  <header class="header-bar">
    <h2>商品搜尋</h2>
    <button nz-button nzType="default" (click)="logout()" class="logout-button">登出</button>
  </header>

  <form nz-form (ngSubmit)="onSearch()" class="search-form">
    <nz-row [nzGutter]="24" nzAlign="middle">
      <nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzFor="type">商品類型</nz-form-label>
          <nz-form-control>
            <nz-select
              [(ngModel)]="type"
              name="type"
              [nzOptions]="typeOptions"
              nzAllowClear
              nzPlaceHolder="請選擇商品類型"
              (ngModelChange)="onTypeChange($event)"
            ></nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzFor="currency">幣別</nz-form-label>
          <nz-form-control>
            <nz-select
              [(ngModel)]="currency"
              name="currency"
              [nzOptions]="currencyOptions"
              nzAllowClear
              nzPlaceHolder="請選擇幣別"
              (ngModelChange)="onCurrencyChange($event)"
            ></nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="4" class="soldout-checkbox-col">
        <nz-form-item>
          <nz-form-control>
            <!-- 變更為 isSoldout -->
            <label nz-checkbox [(ngModel)]="notSoldout" name="isSoldout">有庫存</label>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="8">
        <nz-form-item>
          <!-- 變更為價格範圍 -->
          <nz-form-label>價格範圍</nz-form-label>
          <nz-form-control>
            <!-- 變更為 priceRange -->
            <nz-slider
              [(ngModel)]="priceRange"
              name="priceRange"
              [nzRange]="true"
              [nzMin]="0"
              [nzMax]="1000"
            ></nz-slider>
            <!-- 變更為 priceRange -->
            <div class="price-range-label">{{ priceRange[0] }} - {{ priceRange[1] }}</div>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>

    <div class="button-row">
      <button nz-button nzType="primary" htmlType="submit" class="search-button">
        搜尋
      </button>
    </div>
  </form>

  <div class="product-grid">
    <nz-row [nzGutter]="[16, 16]">
      <nz-col
        [nzSpan]="6"
        *ngFor="let p of products"
        (click)="viewProductDetail(p.id)"
      >
        <div class="product-card clickable-card" style="width: 200px; height: 250px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; overflow: hidden; border: 1px solid #e8e8e8; border-radius: 8px; padding: 10px;">
          <img
            [src]="p.imageUrl || 'https://placehold.co/200x200/A8A29E/ffffff?text=Product'"
            alt="商品預覽圖"
            class="product-image"
            style="width: 100%; height: 200px; object-fit: cover;"
          />
          <div style="font-size: 16px; font-weight: bold; margin-top: 8px;">{{ p.name }}</div>
        </div>
      </nz-col>
    </nz-row>
  </div>
</div>

<ng-template #productDetail >
  <div *ngIf="selectedProduct">
    <div style="text-align: center; margin-bottom: 20px;">
      <img [src]="selectedProduct.imageUrl || 'https://placehold.co/300x300/A8A29E/ffffff?text=Product+Image'" alt="商品圖片" style="width: 300px; height: 300px; border-radius: 8px;" />
    </div>

    <p><b>類型：</b> {{ selectedProduct.type }}</p>
    <p><b>幣別：</b> {{ selectedProduct.currency }}</p>
    <p><b>庫存：</b> {{ selectedProduct.stockQuantity}}</p>
    <p><b>價格：</b> {{ selectedProduct.price}}</p>
    <p><b>備註：</b> {{ selectedProduct.notes }}</p>
    <p><b>描述：</b> {{ selectedProduct.description }}</p>

    <div style="margin-top: 16px;">
      <button nz-button (click)="addToFavorite(selectedProduct.id)">加入收藏</button>
      <button nz-button (click)="shareProduct(selectedProduct.id)">分享</button>
    </div>
  </div>
</ng-template>
